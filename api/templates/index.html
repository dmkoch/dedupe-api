{% extends 'base.html' %}
{% block content %}
<div class="col-md-12">
<div class="panel-group" id="accordion">
  <div class="panel panel-default">
    <div class="panel-heading">
      <h4 class="panel-title">
        <a data-toggle="collapse" data-parent="#accordion" href="#accordionAbout">
          <i class='icon-info-sign'></i> What is Spreadsheet Deduper?
        </a>
      </h4>
    </div>
    <div id="accordionAbout" class="panel-collapse collapse">
      <div class="panel-body">
        <div class="col-md-8">
            <p>Do you have a spreadsheet with duplicate entries?</p>

            <p><strong>This tool can identify or remove them.</strong></p>

            <ol>
                <li>Upload a spreadsheet with up to 10,000 rows</li>
                <li>Choose which columns you want to compare</li>
                <li>Train the system by marking 20 or more positive or negative matches</li>
                <li>Download your original data with the <strong>duplicates identified</strong> or <strong>removed</strong></li>
            </ol>

            <p>We use the <a href='https://github.com/datamade/dedupe'>dedupe library</a> to identify duplicates in any spreadsheet in <strong>less than 5 minutes</strong>. <a href='/about/'>Read more &raquo;</a></p>

            <p><a class='btn btn-primary' href='#' id='closeAbout'>Ok, thanks!</a></p>
        </div>
    </div>
  </div>
</div>
</div>
<br />
<div class="col-md-12">
{% include "dedupe_steps.html" %}
<h3>1. Upload a spreadsheet</h3>
{% include "error.html" %}
</div>
<div class="col-md-8">

  <div class='well'>

    <form role="form" action="{{ url_for('trainer.index') }}" method="POST" enctype="multipart/form-data">
        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}" />
        <!-- <div class="form-group">
            <label for="input_file">Give us a database connection string ...</label>
            <input type="text" class="form-control" name="conn_string" placeholder="Connection string" />
            <p class="help-block">
                Under the hood, we are using <a href="http://www.sqlalchemy.org/">SQLAlchemy</a>
                to connect to your database. Check <a href="http://docs.sqlalchemy.org/en/rel_0_9/core/engines.html#database-urls">here</a>
                to see how the connection string should be formatted.
            </p>
        </div>
        <div class="form-group">
            <input type="text" class="form-control" name="table_name" placeholder="Table name" />
            <p class="help-block">We also need to know which table to deduplicate</p>
        </div> -->
        <div class="form-group">
            <label for="input_file">Upload a spreadsheet to get started.</label>
            <input type="file" id="input_file" name="input_file">
            <p class="help-block">
                Only <strong>.csv, .xls or .xlsx</strong> files that have <strong>less than 10,000 rows</strong>.
                <br />
                <a href='/about/#data-policy'>We don't keep your data</a>, but please don't upload any sensitive information.
            </p>
        </div>
        <hr />
        <button type="submit" id="submit-upload" class="btn btn-primary">Next &raquo;</button>
    </form>
  </div>
</div>
<div class="col-md-4">
    <div class='alert alert-success'>
        <h4>
            <i class='icon-wrench'></i>
            Custom implementations
        </h4>
        <p>Want to de-duplicate data that is:</p>
        <ul>
            <li>bigger?</li>
            <li>more complicated?</li>
            <li>sensitive?</li>
        </ul>

        <p><br /><a href='http://datamade.us'>DataMade</a> can set up a custom implementation. <a href='http://datamade.us/contact-us/'>Contact us</a> to get started.</p>
    </div>
</div>
{% if user.sessions %}
<div class="col-md-12">
    <h4>Your trained sessions</h4>
    <table class="table">
        <thead>
            <tr>
                <th>Name</th>
                <th>Session ID</th>
                <th>Training Data</th>
                <th>Settings File</th>
                <th>Field Definitions</th>
                <th>Delete</th>
            </tr>
        </thead>
        <tbody>
            {% for sess in user.sessions %}
                <tr>
                    <td>
                        {{sess.name}}
                    </td>
                    <td>
                        {{sess.id}}
                    </td>
                    <td>
                        <a href="{{ url_for('endpoints.training_data', session_id=sess.id) }}">Download</a>
                    </td>
                    <td>
                        <a href="{{ url_for('endpoints.settings_file', session_id=sess.id) }}">Download</a>
                    </td>
                    <td>
                        <a href="{{ url_for('endpoints.field_definitions', session_id=sess.id) }}">Download</a>
                    </td>
                    <td>
                        <a href="{{ url_for('endpoints.delete_session', session_id=sess.id ) }}">Delete</a>
                    </td>
                </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endif %}
{% endblock %}

{% block extra_javascript %}
<script type="text/javascript" src="/static/js/jquery.cookie.js"></script>
<script type="text/javascript">

  if ($.cookie("show-welcome") != "read") {
    $('#accordionAbout').collapse('show');
    $.cookie("show-welcome", "read", { expires: 7 });
  }

  $('#closeAbout').click(function(){
    $('#accordionAbout').collapse('hide');
  });

</script>
{% endblock %}
